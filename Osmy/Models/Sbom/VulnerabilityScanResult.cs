using Microsoft.EntityFrameworkCore;
using Osmy.Models.Sbom;
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.Linq;

namespace Osmy.Models.Sbom
{
    public sealed class VulnerabilityScanResult
    {
        [Key]
        public int Id { get; set; }

        public int SbomId { get; set; }
        public Sbom Sbom { get; set; }

        public DateTime Executed { get; set; }
        public bool IsVulnerable { get; set; }

        [DeleteBehavior(DeleteBehavior.Cascade)]
        public List<PackageScanResult> Results { get; set; }

        public VulnerabilityScanResult() : this(DateTime.Now, default!, new List<PackageScanResult>()) { }

        public VulnerabilityScanResult(DateTime executed, Sbom sbom, IEnumerable<PackageScanResult> results)
        {
            Executed = executed;
            Sbom = sbom;
            Results = new List<PackageScanResult>(results);
            IsVulnerable = Results.Any(x => x.IsVulnerable);
        }
    }
}
