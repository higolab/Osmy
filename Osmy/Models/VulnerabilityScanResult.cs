using Osmy.Models.Sbom;
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.Linq;

namespace Osmy.Models
{
    public class VulnerabilityScanResult
    {
        [Key]
        public int Id { get; set; }

        public int SoftwareId { get; set; }
        public virtual Software Software { get; set; }

        public DateTime Executed { get; set; }
        public bool IsVulnerable { get; set; }
        public virtual List<PackageScanResult> Results { get; set; }

        public VulnerabilityScanResult() : this(DateTime.Now, default!, new List<PackageScanResult>()) { }

        public VulnerabilityScanResult(DateTime executed, Software software, IEnumerable<PackageScanResult> results)
        {
            Executed = executed;
            Software = software;
            Results = new List<PackageScanResult>(results);
            IsVulnerable = Results.Any(x => x.IsVulnerable);
        }
    }
}
