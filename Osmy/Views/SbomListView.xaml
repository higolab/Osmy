<UserControl x:Class="Osmy.Views.SbomListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:graphsharp="clr-namespace:GraphSharp.Controls;assembly=GraphSharp.Controls"
             xmlns:zoom="clr-namespace:GraphSharp.Controls.Zoom;assembly=GraphSharp.Controls"
             xmlns:quickgraph="clr-namespace:QuickGraph;assembly=QuickGraph"
             xmlns:prism="http://prismlibrary.com/"
             prism:ViewModelLocator.AutoWireViewModel="True"
             xmlns:local="clr-namespace:Osmy.Views"
             xmlns:models="clr-namespace:Osmy.Models.Sbom"
             xmlns:viewmodels="clr-namespace:Osmy.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="400" d:DesignWidth="700"
             d:DataContext="{d:DesignInstance Type=viewmodels:SbomListViewViewModel}">
  <Grid Margin="5 0 0 0">
    <Grid.RowDefinitions>
      <RowDefinition Height="30"/>
      <RowDefinition Height="*"/>
    </Grid.RowDefinitions>

    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="*"/>
      <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>

    <TextBlock Grid.Row="0" Text="Softwares" VerticalAlignment="Center"/>
    <ListView Grid.Row="1" ItemsSource="{Binding Softwares.Value}"
              SelectedItem="{Binding SelectedSouftware.Value}" SelectionMode="Single">
      <ListView.ItemTemplate>
        <DataTemplate DataType="{x:Type models:Software}">
          <StackPanel>
            <TextBlock Text="{Binding Name}"/>
            <!--<TextBlock Text="{Binding Sboms[0]}"/>-->
          </StackPanel>
        </DataTemplate>
      </ListView.ItemTemplate>
    </ListView>

    <StackPanel Grid.Row="1" Height="30" Margin="0 0 5 5"
                VerticalAlignment="Bottom" HorizontalAlignment="Right"
                Orientation="Horizontal">
      <Button ToolTip="Add Software"
              Command="{Binding AddSoftwareCommand}">
        <iconPacks:PackIconMaterial Kind="Plus"/>
      </Button>

      <Button ToolTip="Scan" Content="Scan" Command="{Binding ScanVulnsCommand}"/>
    </StackPanel>

    <Grid Grid.Row="1" Grid.Column="1">
      <Grid.RowDefinitions>
        <RowDefinition Height="30"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>

      <TextBlock Grid.Row="0" Text="Detail"/>

      <TabControl Grid.Row="1">
        <TabItem Header="Dependency Graph">
          <zoom:ZoomControl Zoom="0.2">
            <zoom:ZoomControl.Resources>
              <DataTemplate x:Key="demoTemplate" DataType="{x:Type models:IPackage}">
                <StackPanel Orientation="Horizontal" Margin="5">
                  <TextBlock Text="{Binding Name}" Foreground="White" />
                </StackPanel>
              </DataTemplate>

              <Style TargetType="{x:Type graphsharp:VertexControl}">
                <Setter Property="Template">
                  <Setter.Value>
                    <ControlTemplate TargetType="{x:Type graphsharp:VertexControl}">
                      <Border BorderBrush="White" 
                        Background="Black"
                        BorderThickness="2"
                        CornerRadius="10,10,10,10"
                        Padding="{TemplateBinding Padding}">
                        <ContentPresenter Content="{TemplateBinding Vertex}" 
                                    ContentTemplate="{StaticResource demoTemplate}"/>

                        <Border.Effect>
                          <DropShadowEffect BlurRadius="2" Color="LightGray" 
                                      Opacity="0.3" Direction="315"/>
                        </Border.Effect>
                      </Border>
                    </ControlTemplate>
                  </Setter.Value>
                </Setter>
              </Style>

              <Style TargetType="{x:Type graphsharp:EdgeControl}">
                <Style.Resources>
                  <ToolTip x:Key="ToolTipContent">
                    <StackPanel>
                      <TextBlock FontWeight="Bold" Text="Edge.ID"/>
                      <TextBlock Text="{Binding Id}"/>
                    </StackPanel>
                  </ToolTip>
                </Style.Resources>
                <Setter Property="ToolTip" Value="{StaticResource ToolTipContent}"/>
              </Style>
            </zoom:ZoomControl.Resources>

            <local:DependencyGraphLayout Graph="{Binding Graph.Value}"
                                   Margin="10"
                                   LayoutAlgorithmType="LinLog"
                                   OverlapRemovalAlgorithmType="FSA"
                                   HighlightAlgorithmType="Simple">
            </local:DependencyGraphLayout>
          </zoom:ZoomControl>
        </TabItem>
      </TabControl>
    </Grid>
  </Grid>
</UserControl>
