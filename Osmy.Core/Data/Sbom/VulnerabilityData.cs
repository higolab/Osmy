using OSV.Schema;
using System.Text.Json;
using System.Text.Json.Serialization;

namespace Osmy.Core.Data.Sbom
{
    public class VulnerabilityData
    {
        /// <summary>
        /// ID
        /// </summary>
        public string Id { get; set; }

        /// <summary>
        /// 最終変更日時
        /// </summary>
        public DateTimeOffset Modified { get; set; }

        /// <summary>
        /// 文字列データ
        /// </summary>
        public string Data { get; set; }

        /// <summary>
        /// 脆弱性情報
        /// </summary>
        /// <remarks><see cref="Data"/>をデシリアライズしたものです．</remarks>
        [JsonIgnore]
        public Vulnerability? Vulnerability => _vulnerability ??= JsonSerializer.Deserialize<Vulnerability>(Data);
        private Vulnerability? _vulnerability;

        public VulnerabilityData(string id, DateTimeOffset modified, string data)
        {
            Id = id;
            Modified = modified;
            Data = data;
        }

        public VulnerabilityData() : this(string.Empty, DateTimeOffset.MinValue, string.Empty) { }
    }
}
